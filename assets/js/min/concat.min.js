"object"!=typeof data&&(data={}),function(){"use strict";data.extendObject=function(t,e){var n,a=Object.prototype.hasOwnProperty;for(n in e)a.call(e,n)&&(t[n]=e[n]);return t},data.createClass=function(t,e){function n(){}function a(){this.init.apply(this,arguments)}return e||(e=t,t={}),n.prototype=t.prototype,a.prototype=new n,a.parent=t.prototype,data.extendObject(a.prototype,e),a}}(),function(){"use strict";void 0===Array.prototype.indexOf&&(Array.prototype.indexOf=function(t){var e;for(e in this)if(this[e]===t)return e;return-1}),"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")})}(),function(t){t.load=function(e,n){n||(n={});var a,r,s,o=new XMLHttpRequest,i={type:"GET",data:""};n=t.extendObject(n,i),window.XDomainRequest?(r=function(){n.callback(a.responseText)},a=new XDomainRequest,a.open(n.type,e),a.onload=r,a.send(JSON.stringify(n.data))):(r=function(){o.responseXML?o.responseXML&&n.callback(o.responseXML):n.callback(o.responseText)},s=function(){n.fail&&n.fail(o.statusText)},o.open(n.type,e),o.onreadystatechange=function(){4===o.readyState&&200===o.status?(console.log(o),r()):s()},o.send(JSON.stringify(n.data)))},t.forEach=function(t,e){var n,a=Object.prototype.hasOwnProperty;for(n in t)a.call(t,n)&&e(n,t[n])},t.forEachDeep=function(t,e){var n,a;Object.prototype.hasOwnProperty;for(n in t)for(a in t[n])e(n,a,t[n][a])}}(data),function(){"use strict";data.CSVtoJSON=function(t,e,n){e||(e=","),","!==e&&(t=t.replace(e,",")),t=t.replace(/,(?=\n\r|\n|\r)/g,"");var a,r,s=t.split(/\n(?![\w]+["])/g),o=s[0].split(/(?!"),(?![\w]+["])/g),i=new data.CSVObject;return o.length,o=i.setColumns(o),s.splice(0,1),data.forEach(s,function(t,e){a=e.split(/(?!"),(?![\w]+["])/g),r={},data.forEach(a,function(t,e){r[o[t]]=e.replace(/(?=[\w]*)"(?!")/g,""),/^[\-]?[0-9]+[\.]?[0-9]*$/g.test(r[o[t]])&&(r[o[t]]=data.parseNum(r[o[t]]))}),i.push(r)}),n&&"function"==typeof n&&n(i),i},data.JSONtoCSV=function(t,e){for(var n=[],a=[],r=0;r<t.length;r+=1)data.forEach(t[r],function(t){n.indexOf(t)<0&&n.push(t)}),a.push(data.delimit(t[r],e)+"\n");return a.unshift(data.delimit(n,e)+"\n"),a.join("")},data.delimit=function(t,e){e||(e=",");var n="";return data.forEach(t,function(t,a){if("string"!=typeof a&&(a=a.toString()),a.match(/["\n,]/g)){var r=a.replace(/"/g,'""');n+='"'+r+'",'}else n+=a+e}),n=n.replace(/(\r\n|\n|\r)/gm,"")},data.countRows=function(t,e){void 0===e&&(e=!1);var n=t.split(/\n(?![\w]+["])/g).length;return e||(n-=1),n},data.isValidCSV=function(t){t=t.replace(/,(?=\n\r|\n|\r)/g,"");var e,n=t.split(/\n(?![\w]+["])/g),a=n[0].split(/(?!"),(?![\w]+["])/g).length,r=!0;return n.splice(0,1),data.forEach(n,function(t,s){e=s.split(/(?!"),(?![\w]+["])/g).length,e!==a&&t!==n.length&&""!==s&&t!==n.length-1&&(r=!1)}),r},data.CSVrowsWhere=function(t,e){var n,a=new data.CSVMatcher(t,e);return n=a.rows},data.drawAsTable=function(t,e,n,a){var r,s,o,i,c=document.createElement("table"),h=document.createElement("tbody"),u=document.createElement("thead"),d={};for(Object.prototype.hasOwnProperty,u.appendChild(document.createElement("tr")),r=0;r<t.columns.length;r+=1)d[t.columns[r]]=[];for(data.forEach(t.rows,function(t,e){data.forEach(e,function(t,e){d[t].push(e)})}),r=0;r<d[t.columns[0]].length;r+=1)h.appendChild(document.createElement("tr"));for(h.rows.length||(i=h.getElementsByTagName("tr")),r=0;r<t.columns.length;r+=1){var l=document.createElement("th");for(l.appendChild(document.createTextNode(t.columns[r])),u.appendChild(l),s=0;s<d[t.columns[r]].length;s+=1){var p=document.createElement("td");p.appendChild(document.createTextNode(d[t.columns[r]][s])),void 0!==h.rows.length&&0!==h.rows.length?h.rows[s].appendChild(p):i[s].appendChild(p)}}for(o in e)c.setAttribute(o,e[o]);return c.appendChild(u),c.appendChild(h),console.log(n,$(n)),$(n)[0].appendChild(c),a&&"function"==typeof a&&setTimeout(a,1e3),c},data.CSVfromTable=function(t){var e,n=t.getElementsByTagName("thead")[0],a=t.getElementsByTagName("tbody")[0],r=n.getElementsByTagName("th"),s=a.getElementsByTagName("tr"),o=(Object.prototype.hasOwnProperty,{columns:[],rows:[]}),i=0,c=new data.CSVObject;return data.forEach(r,function(t,e){1===e.nodeType&&o.columns.push(e.innerHTML)}),data.forEach(s,function(t,n){1===n.nodeType&&(e={},data.forEach(n.childNodes,function(t,n){1===n.nodeType&&"td"===n.tagName.toLowerCase()&&(e[o.columns[i]]=n.innerHTML,i+=1)}),c.push(e),i=0)}),c.setColumns(o.columns),c},data.parseNum=function(t){return isNaN(parseFloat(t,10))?t:parseFloat(t,10)}}(data),data.CSVMatcher=function(){"use strict";var t={types:["equals","morethan","lessthan","notequal","contains","matches"],equals:{discover:/[\w\s]*\s(?=equals|[\=]{1,3}(?!=))/,delimeter:/\s[\=]{1,3}(?!=)/,delimitMatch:/\s[\=]{1,3}/g,delimitFalse:"equals"},morethan:{discover:/[\w\s]*\s(?=greater than|[\>?]{1}(?=\s))/,delimeter:/\s[\>]{1}(?=\s)/,delimitMatch:/\s[\>]{1}/g,delimitFalse:"greater than"},lessthan:{discover:/[\w\s]*\s(?=less than|[\\<]{1}(?=\s))/,delimeter:/\s[\\<]{1}(?=\s)/,delimitMatch:/\s[\\<]{1}/g,delimitFalse:"less than"},notequal:{discover:/[\w\s]*\s(?=not equal to|[\!]{1}[\=]{2}(?=\s))/,delimeter:/\s[!]{1}[=]{2}(?=[\s])/,delimitMatch:/\s[!]{1}[=]{2}/g,delimitFalse:"not equal to"},contains:{discover:/[\w\s]*\s(?=contains)/g,delimeter:/\s(?=contains\s)/,delimitMatch:/\scontains\s/g},matches:{discover:/[\w\s]*\s(?=matches)/,delimeter:/\s(?=matches\s)/,delimitMatch:/\smatches\s/g}};return new data.createClass({init:function(t,e){this.CSVData=t,this.testString=e,this.matchers={},this.rows=[],"object"!=typeof this.CSVData&&(data.isValidCSV(this.CSVData),this.CSVData=data.CSVtoJSON(this.CSVData)),this.findCombo(),1===this.combos.length?(this.discoverType(),this.findDelimeter(),this.findQueryParts(),this.addMatchers(),this.doMatch()):this.processMultiple()},discoverType:function(){var e,n=this;if(data.forEach(t.types,function(a,r){t[r].discover.test(n.testString)&&(n.testType=e=r)}),!e)throw new Error("No valid match expression found: "+n.testString);return e},findDelimeter:function(){var e=t[this.testType].delimeter.test(this.testString),n=t[this.testType];if(e)this.delimeter=n.delimitMatch instanceof RegExp?this.testString.match(n.delimitMatch)[0]:n.delimitMatch;else{if(!(this.testString.indexOf(n.delimitFalse)>-1))throw new Error("No valid delimeter found in match expression.\n (If you're seeing this error, I messed up somwehere)");this.delimeter=n.delimitFalse}return this.delimeter=this.delimeter.trim(),this.delimeter},findQueryParts:function(){var e,n,a=this.delimeter,r=this.testString;return t[this.testType],e=r.substring(0,r.indexOf(a)-1).trim(),n=r.substring(r.indexOf(a)+a.length+1,r.length).trim(),this.queryParts=[e,n],[e,n]},doMatch:function(){var t,e=this.matchers[this.testType];if(void 0!==e)return t=this[e].apply(this,this.queryParts);throw new TypeError("No match function found for type "+this.testType)},addMatchers:function(t){var e,n;Object.prototype.hasOwnProperty,t||(t=this),this.matchers||(this.matchers={});for(e in t)n=e.match(/[\w]*(?=Matcher)/),n&&n.length>0&&(this.matchers[n[0]]=e);return delete this.matchers.add,this.matchers},equalsMatcher:function(t,e){return this.performBasicMatch("=",t,e),this.rows},morethanMatcher:function(t,e){return this.performBasicMatch(">",t,e),this.rows},lessthanMatcher:function(t,e){return this.performBasicMatch("<",t,e),this.rows},notequalMatcher:function(t,e){return this.performBasicMatch("!=",t,e),this.rows},containsMatcher:function(t,e){var n=this;data.forEachDeep(this.CSVData,function(a,r,s){s=s.toString().trim(),r=r.trim(),r===t&&s.indexOf(e)>-1&&n.rows.push(n.CSVData[a])})},matchesMatcher:function(t,e){var n,a,r=this;"/"===e.substring(0,1)&&(e=e.substring(1,e.length)),/\/[gim]/.test(e.substr(e.length-2,2))&&(n=e.substr(e.length-1,1),e=e.substring(0,e.length-2)),a=new RegExp(e,n),data.forEachDeep(this.CSVData,function(e,n,s){s=s.toString().trim(),n=n.trim(),n===t&&a.test(s)&&r.rows.push(r.CSVData[e])})},performBasicMatch:function(t,e,n){var a=[">","<","=","!="],r=this;if(!(a.indexOf(t)>-1))throw new Error("A basic match cannot be performed for "+t);return data.forEachDeep(this.CSVData,function(a,s,o){if(o=o.toString().trim(),s=s.trim(),s===e)switch(t){case">":parseInt(o,10)>parseInt(n,10)&&r.rows.push(r.CSVData[a]);break;case"<":parseInt(o,10)<parseInt(n,10)&&r.rows.push(r.CSVData[a]);break;case"=":o===n&&r.rows.push(r.CSVData[a]);break;case"!=":o!==n&&r.rows.push(r.CSVData[a])}}),r.rows},findCombo:function(){var t=this;return this.combos=this.testString.split(/(\sand\s|\s[&]{2}(?!&)\s)/g),data.forEach(this.combos,function(e,n){/(and|[&]{2})/g.test(n)&&t.combos.splice(e,1)}),this.combos},processMultiple:function(){var t=new data.CSVMatcher(this.CSVData,this.combos[0]);this.combos.splice(0,1),data.forEach(this.combos,function(e,n){t=new data.CSVMatcher(t.rows,n)}),this.rows=t.rows}})}(),data.CSVObject=function(){"use strict";return data.createClass({init:function(){this.rowCount=null,this.columns=[],this.rows=[]},push:function(t){return Array.prototype.push.call(this.rows,t),this.rowCount+=1,this.rows},where:function(t){var e=new data.CSVMatcher(this.rows,t),n=new data.CSVObject;return n.setColumns(this.columns),data.forEach(e.rows,function(t,e){n.push(e)}),n},setColumns:function(t){var e=this;return this.columns||(this.columns=[]),data.forEach(t,function(t,n){e.columns.push(n.trim())}),this.columns},get:function(t){var e=[];return data.forEachDeep(this.rows,function(n,a,r){a===t&&e.push(r)}),1===e.length&&(e=e[0]),e},toCSV:function(t){return data.JSONtoCSV(this.rows,t)}})}(),function(t){t.getRootElementName=function(t){var e;for(e in t.childNodes)if(1===t.childNodes[e].nodeType)return t.childNodes[e].tagName;throw new Error("Could not find root element")},t.countChildNodes=function(e){var n,a=0,r=t.getRootElementName(e),s=e.getElementsByTagName(r)[0].childNodes;for(n in s)s[n].nodeType&&3!==s[n].nodeType&&(a+=1);return a},t.JSONtoXML=function(e,n){var a={rootTagName:"JSON"};n||(n=a.rootTagName);var r,s=document.implementation.createDocument(null,null,null);r=document.createElement(n),s.appendChild(r),t.forEach(e,function(t,e){var n=document.createElement(t);n.innerHTML=e,r.appendChild(n)}),console.log(s)}}(data),function(t){"use strict";t.mapXML=function(e){var n,a;return t.forEach(e.childNodes,function(t,e){return 1===e.nodeType?(n=e,!1):void 0}),a={},a[n.tagName]={},a}}(data);