/*! Data.js 2013-10-08 */
"object"!=typeof data&&(data={}),function(){"use strict";data.extendObject=function(a,b){var c,d=Object.prototype.hasOwnProperty;for(c in b)d.call(b,c)&&(a[c]=b[c])},data.createClass=function(a,b){function c(){}function d(){this.init.apply(this,arguments)}return b||(b=a,a={}),c.prototype=a.prototype,d.prototype=new c,d.parent=a.prototype,data.extendObject(d.prototype,b),d}}(),function(a){a.load=function(a,b){var c=new XMLHttpRequest;c.open(b.type,a),c.onload=function(){b.callback(c.responseText)},c.send(JSON.stringify(b.data))},a.forEach=function(a,b){var c;for(c in a)b(c,a[c])},a.forEachDeep=function(a,b){var c,d;for(c in a)for(d in a[c])b(c,d,a[c][d])}}(data),function(){"use strict";data.CSVtoJSON=function(a,b){b||(b=","),","!==b&&(a=a.replace(b,",")),a=a.replace(/,(?=\n\r|\n|\r)/g,"");var c,d=a.split(/\n(?![\w]+["])/g),e=d[0].split(/(?!"),(?![\w]+["])/g),f=[];return e.length,d.splice(0,1),data.forEach(d,function(a,b){c=b.split(/(?!"),(?![\w]+["])/g);var d={};data.forEach(c,function(a,b){d[e[a]]=b.replace(/(?=[\w]*)"(?!")/g,"")}),f.push(d)}),f},data.JSONtoCSV=function(a){for(var b=[],c=[],d=0;d<a.length;d+=1)data.forEach(a[d],function(a){b.indexOf(a)<0&&b.push(a)}),c.push(data.delimit(a[d])+"\n");return c.unshift(data.delimit(b)+"\n"),c.join("")},data.delimit=function(a){var b="";return data.forEach(a,function(a,c){if(c.match(/["\n,]/g)){var d=c.replace(/"/g,'""');b+='"'+d+'",'}else b+=c+","}),b=b.replace(/(\r\n|\n|\r)/gm,"")},data.countRows=function(a,b){void 0===b&&(b=!1);var c=a.split(/\n(?![\w]+["])/g).length;return b||(c-=1),c},data.isValidCSV=function(a){a=a.replace(/,(?=\n\r|\n|\r)/g,""),console.log(a);var b,c=a.split(/\n(?![\w]+["])/g),d=c[0].split(/(?!"),(?![\w]+["])/g).length,e=!0;return c.splice(0,1),data.forEach(c,function(a,f){b=f.split(/(?!"),(?![\w]+["])/g).length,b!==d&&a!==c.length&&(e=!1)}),e},data.CSVrowsWhere=function(a,b){var c,d=new data.CSVMatcher(a,b);return c=d.rows}}(data),data.CSVMatcher=function(){"use strict";var a={types:["equals","morethan","lessthan"],equals:{discover:/[\w\s]*\s(?=equals|[\=]{1,3}(?!=))/,delimeter:/\s[\=]{1,3}(?!=)/,delimitMatch:/\s[\=]{1,3}/g,delimitFalse:"equals"},morethan:{discover:/[\w\s]*\s(?=greater than|[\>?]{1}(?=\s))/,delimeter:/\s[\>]{1}(?=\s)/,delimitMatch:/\s[\>]{1}/g,delimitFalse:"greater than"},lessthan:{discover:/[\w\s]*\s(?=less than|[\\<]{1}(?=\s))/,delimeter:/\s[\\<]{1}(?=\s)/,delimitMatch:/\s[\\<]{1}/g,delimitFalse:"less than"}};return new data.createClass({init:function(a,b){this.CSVData=a,this.testString=b,this.matchers={},this.rows=[],"object"!=typeof this.CSVData&&(data.isValidCSV(this.CSVData),this.CSVData=data.CSVtoJSON(this.CSVData)),this.discoverType(),this.findDelimeter(),this.findQueryParts(),this.addMatchers(),this.doMatch()},discoverType:function(){var b,c=this;if(data.forEach(a.types,function(d,e){a[e].discover.test(c.testString)&&(c.testType=b=e,console.log("Matches test type: "+e))}),!b)throw new Error("No valid match expression found: "+c.testString);return b},findDelimeter:function(){var b=a[this.testType].delimeter.test(this.testString),c=a[this.testType];if(b)console.log("Found match"),this.delimeter=c.delimitMatch instanceof RegExp?this.testString.match(c.delimitMatch)[0]:c.delimitMatch;else{if(!(this.testString.indexOf(c.delimitFalse)>-1))throw new Error("No valid delimeter found in match expression.\n (If you're seeing this error, I messed up somwehere)");this.delimeter=c.delimitFalse}return this.delimeter=this.delimeter.trim(),this.delimeter},findQueryParts:function(){var b,c,d=this.delimeter,e=this.testString;return a[this.testType],b=e.substring(0,e.indexOf(d)-1).trim(),c=e.substring(e.indexOf(d)+d.length+1,e.length).trim(),this.queryParts=[b,c],[b,c]},doMatch:function(){var a,b=this.matchers[this.testType];if(void 0!==b)return a=this[b].apply(this,this.queryParts);throw new TypeError("No match function found for type "+this.testType)},addMatchers:function(a){var b,c;Object.prototype.hasOwnProperty,a||(a=this),this.matchers||(this.matchers={});for(b in a)c=b.match(/[\w]*(?=Matcher)/),c&&c.length>0&&(this.matchers[c[0]]=b);return delete this.matchers.add,this.matchers},equalsMatcher:function(a,b){return this.performBasicMatch("=",a,b),this.rows},morethanMatcher:function(a,b){return this.performBasicMatch(">",a,b),this.rows},lessthanMatcher:function(a,b){return this.performBasicMatch("<",a,b),this.rows},performBasicMatch:function(a,b,c){var d=[">","<","="],e=this;if(!(d.indexOf(a)>-1))throw new Error("A basic match cannot be performed for "+a);return data.forEachDeep(this.CSVData,function(d,f,g){if(g=g.trim(),f=f.trim(),f===b)switch(a){case">":parseInt(g,10)>parseInt(c,10)&&e.rows.push(d);break;case"<":parseInt(g,10)<parseInt(c,10)&&e.rows.push(d);break;case"=":g===c&&e.rows.push(d)}}),e.rows}})}(),function(){"use strict";void 0===Array.prototype.indexOf&&(Array.prototype.indexOf=function(a){var b;for(b in this)if(this[b]===a)return b;return-1}),void 0===String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/[\s]+/g,"")})}(),function(a){a.getRootElementName=function(a){var b;for(b in a.childNodes)if(1===a.childNodes[b].nodeType)return a.childNodes[b].tagName;throw new Error("Could not find root element")},a.countChildNodes=function(b){var c,d=0,e=a.getRootElementName(b),f=b.getElementsByTagName(e)[0].childNodes;for(c in f)f[c].nodeType&&3!==f[c].nodeType&&(d+=1);return d},a.JSONtoXML=function(b,c){var d={rootTagName:"JSON"};c||(c=d.rootTagName);var e,f=document.implementation.createDocument(null,null,null);e=document.createElement(c),f.appendChild(e),a.forEach(b,function(a,b){var c=document.createElement(a);c.innerHTML=b,e.appendChild(c)}),console.log(f)}}(data);